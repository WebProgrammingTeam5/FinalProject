<html>
  <head>
    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>
  </head>

  <body>
  <div id="parent" style="width: 100%; height: 100%;">
      <div id="map" style="width: 50%; height:100%; float: right; display: flex; justify-content: center; align-items: center;">
          map자리
      </div>
      <div id="interface" style="width: 50%; height:60%; float: left; display: flex; justify-content: center; align-items: center;">
       <div>
        <div>
          현재 위치 :
          <span id="position"></span>
        </div>

        <div id="status">HP: <span id="HP"></span></div>
        <div id="game"></div>
        <div id="event_result"></div>
        <div id="control"></div>
        <div>
          <button onclick="{localStorage.removeItem('_key'); location.href='/';}">
            로그아웃
          </button>
        </div>
        
        <div id="inventory">인벤토리</div>
       </div>
      </div> 
  </div>
    
    <script>
      const sendAction = (url, params = {}) => {
        $.ajax({
          url,
          headers: {
            Authorization: 'Bearer ' + key,
          },
          method: 'POST',
          data: $.param(params),
        }).done((req) => {
          const { player, field, event, actions } = req;
          $('#game').text(field.description);
          $('#position').text(`(${field.x},${field.y})`);
          const x = field.x;
          const y = field.y;

          $('#control').html('');
          req.actions.forEach((action) => {
            const dom = $('<button></button>');
            dom.text(action.text);
            dom.bind('click', function () {
              sendAction(action.url, action.params);
            });

            $('#control').append(dom);
          });

          $('#inventory').html('');

          req.player.item.forEach((item) => {
            const itemBox = $('<div></div>');
            itemBox.text(item.name);
            $('#inventory').append(itemBox);
          });

          if (event) {
            $('#event_result').text(event.description);
          } else {
            $('#event_result').text('아무일도 일어나지 않았다.');
          }

          $('#HP').text(`${player.HP} / ${player.maxHP}`);
        });
      };
      const key = localStorage.getItem('_key');
      if (!key) {
        location.href = '/';
      }

      sendAction('/action', { action: 'query' });
    </script>
  </body>
</html>
